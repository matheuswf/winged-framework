<?php$this->html('_includes/navbar');$this->html('_includes/content');$this->html('_includes/menu');use Winged\Formater\Formater;?>    <div class="content-wrapper">        <div class="page-header page-header-default">            <div class="page-header-content">                <div class="page-title">                    <h4><?= $this->page_name ?></h4>                </div>            </div>            <div class="breadcrumb-line">                <ul class="breadcrumb">                    <li class="active"><?= $this->page_action_string ?></li>                </ul>            </div>        </div>        <div class="content">            <?php            if (!$models) {                ?>                <div class="col-lg-12">                    <div class="panel panel-danger">                        <div class="panel-heading">                            <h6 class="panel-title"><i class="icon-cross2"></i>Seu carrinho está vazio</h6>                        </div>                        <div class="panel-body">                            <h6 class="no-margin">                                <small class="display-block" style="margin-bottom:10px">                                    Vá até os <a href="produtos">produtos</a> para adcionar alguns produtos ao carrinho.                                </small>                            </h6>                        </div>                    </div>                </div>                <?php            } else {                ?>                <div id="pedido_success" style="margin-top: 10px; display: none;" class="col-lg-12">                    <div class="panel panel-success">                        <div class="panel-heading">                            <h6 class="panel-title"><i class="icon-check"></i>Pedido número <span id="id_pedido"></span>                                foi                                feito com sucesso</h6>                        </div>                        <div class="panel-body">                            <h6 class="no-margin">                                <small class="display-block" style="margin-bottom:10px">                                    Vá até os <a href="pedidos">pedidos</a> para ver maiores detalhes do pedido.                                </small>                            </h6>                        </div>                    </div>                </div>                <div class="panel panel-flat">                    <div class="panel-body">                        <div class="col-md-12">                            <div class="form-group clearfix">                                <div class="col-lg-12">                                    <label for="clientes">Venda será realizada para o seguinte cliente: </label>                                    <input name="clientes" id="clientes" type="text"                                           class="form-control">                                    <script>var clientes = <?= json_encode($clientes) ?>;</script>                                </div>                            </div>                            <div class="form-group clearfix">                                <div class="col-lg-4">                                    <label for="valor_frete">Valor do frete: </label>                                    <input name="valor_frete" id="valor_frete" type="text"                                           class="form-control"                                           data-old="<?= Formater::intToCurrency($cart->valor_frete) ?>"                                           value="<?= Formater::intToCurrency($cart->valor_frete) ?>">                                </div>                                <div class="col-lg-4">                                    <label for="agendamento">Entrega agendada para: </label>                                    <input name="agendamento" id="agendamento" type="text"                                           class="form-control"                                           data-old="<?= $cart->agendamento ?>"                                           value="<?= $cart->agendamento ?>">                                </div>                                <div class="col-lg-4">                                    <label for="agendamento">Pedido saiu com NF: </label>                                    <div class="radio">                                        <div style="display: inline-block;">                                            <input name="innf" id="innf0" value="0" type="radio" <?= $cart->innf != 1 ? 'checked' : '' ?>><label for="innf0">                                                <span></span>Não                                            </label>                                        </div>                                        <div style="display: inline-block; margin-left: 30px;">                                            <input name="innf" id="innf1" value="1" type="radio" <?= $cart->innf == 1 ? 'checked' : '' ?>><label for="innf1">                                                <span></span>Sim                                            </label>                                        </div>                                    </div>                                </div>                            </div>                            <div class="form-group clearfix">                                <div class="col-lg-12">                                    <label for="metodo_pagamento">Método de pagamento: </label>                                    <input data-old="<?= $cart->metodo_pagamento ?>" name="metodo_pagamento"                                           id="metodo_pagamento" type="text"                                           class="form-control"                                           data-old="<?= $cart->metodo_pagamento ?>"                                           value="<?= $cart->metodo_pagamento ?>">                                </div>                            </div>                            <div class="form-group clearfix">                                <div class="col-lg-12">                                    <label for="agendamento">Observaçoes: </label>                                    <textarea data-old="<?= brtonl($cart->observacoes) ?>" style="height: 120px"                                              id="observacoes" name="observacoes"                                              class="form-control"><?= brtonl($cart->observacoes) ?></textarea>                                </div>                            </div>                            <div style="display: <?= $endereco == '' ? 'none' : 'block' ?>" id="enderecos"                                 class="form-group">                                <div class="col-lg-12">                                    <label for="clientes">Endereço para entrega: </label>                                    <span class="help-block">                                    * O endereço de entrega pré selecionado, é o endereço definido como padrão ou mais recente cadastrado caso não exista nenhum padrão.                                </span>                                    <span class="help-block">                                    * Esse campo <strong>não</strong> é obrigatório, mas ajuda a organizar os pedidos que devem ser entregue aos clientes.                                </span>                                    <select name="enderecos" id="select_enderecos" type="text"                                            class="form-control">                                        <?php                                        $found = false;                                        foreach ($enderecos as $end) {                                            if ($end['value'] == $cart->endereco . ':::' . $cart->id_bairro) {                                                ?>                                                <option value="<?= $end['value'] ?>"                                                        selected><?= $end['text'] ?></option>                                                <?php                                                $found = true;                                            } else {                                                ?>                                                <option value="<?= $end['value'] ?>"><?= $end['text'] ?></option>                                                <?php                                            }                                        }                                        if (!$found) {                                            ?>                                            <option value="<?= $cart->endereco ?>"><?= $cart->endereco ?></option>                                            <?php                                        }                                        ?>                                    </select>                                </div>                            </div>                        </div>                    </div>                </div>                <div class="panel panel-flat">                    <div id="DataTables_Table_1_wrapper" class="dataTables_wrapper no-footer">                        <div class="datatable-scroll-wrap">                            <table id="mod-carrinho" class="table table-bordered no-footer dataTable">                                <thead>                                <tr role="row">                                    <th class="sorting"                                        onclick="window.open('<?= \Admin::buildGetUrlSorting('sort_nome') ?>', '_self');"                                        rowspan="1" colspan="1">Produto                                    </th>                                    <th class="sorting"                                        onclick="window.open('<?= \Admin::buildGetUrlSorting('sort_valor_unitario') ?>', '_self');"                                        rowspan="1" colspan="1">Valor unitário                                    </th>                                    <th class="sorting"                                        onclick="window.open('<?= \Admin::buildGetUrlSorting('sort_valor_atacado') ?>', '_self');"                                        rowspan="1" colspan="1">Valor atacado                                    </th>                                    <th style="display: none;" class="sorting"                                        onclick="window.open('<?= \Admin::buildGetUrlSorting('sort_valor_minimo') ?>', '_self');"                                        rowspan="1" colspan="1">Valor mínimo                                    </th>                                    <th style="display: none;" class="sorting"                                        onclick="window.open('<?= \Admin::buildGetUrlSorting('sort_valor_de_custo') ?>', '_self');"                                        rowspan="1" colspan="1">Valor de custo                                    </th>                                    <th class="sorting"                                        onclick="window.open('<?= \Admin::buildGetUrlSorting('sort_quantidade_estoque') ?>', '_self');"                                        rowspan="1" colspan="1">Quantidade em estoque                                    </th>                                    <th rowspan="1" colspan="1">Quantidade</th>                                    <th style="display: none;" rowspan="1" colspan="1">% de desconto</th>                                    <th rowspan="1" colspan="1">Valor unitário</th>                                    <th rowspan="1" colspan="1">Valor unitário final</th>                                    <th rowspan="1" colspan="1">Valor total</th>                                    <th rowspan="1" colspan="1">Remover</th>                                </tr>                                </thead>                                <tbody>                                <?php                                /**                                 * @var $models array | Carrinho[]                                 * @var $model Carrinho                                 */                                $quantidade_total = 0;                                $valor_total = 0;                                foreach ($models as $model) {                                    ?>                                    <tr data-id="<?= $model->primaryKey() ?>" role="row" class="even">                                        <td><?= $model->extra()->nome ?></td>                                        <td class="valor_unitario">                                            R$ <?= Formater::intToCurrency($model->extra()->valor_unitario) ?></td>                                        <td class="valor_atacado">                                            R$ <?= Formater::intToCurrency($model->extra()->valor_atacado) ?></td>                                        <td style="display: none">R$ <?= Formater::intToCurrency($model->extra()->valor_minimo) ?></td>                                        <td style="display: none">R$ <?= Formater::intToCurrency($model->extra()->valor_de_custo) ?></td>                                        <td class="quantidade_estoque"><?= $model->extra()->quantidade_estoque ?></td>                                        <?php                                        $quantidade_total += $model->quantidade;                                        $valor_total += ($model->valor_unico - (($model->valor_unico * $model->porcentagem_desconto / 100))) * $model->quantidade;                                        ?>                                        <td <?= $model->quantidade > $model->extra()->quantidade_estoque ? 'style="background: #ff7a7a"' : '' ?>>                                            <div style="margin: 0" class="form-group">                                                <input field-name="Quantidade" name="quantidade"                                                       class="quantidade form-control"                                                       data-old="<?= $model->quantidade ?>"                                                       value="<?= $model->quantidade ?>"/>                                            </div>                                        </td>                                        <td style="display: none">                                            <div style="margin: 0" class="form-group">                                                <input field-name="Porcentagem de desconto" name="porcentagem_desconto"                                                       class="porcentagem_desconto form-control"                                                       data-old="<?= $model->porcentagem_desconto ?>"                                                       value="<?= $model->porcentagem_desconto ?>"/>                                            </div>                                        </td>                                        <td <?= $model->valor_unico - (($model->valor_unico * $model->porcentagem_desconto / 100)) < $model->extra()->valor_minimo ? 'style="background: #ff7a7a"' : '' ?>>                                            <div style="margin: 0" class="form-group">                                                <input field-name="Valor unitário" name="valor_unico"                                                       class="valor_unico form-control"                                                       data-old="<?= Formater::intToCurrency($model->valor_unico) ?>"                                                       value="<?= Formater::intToCurrency($model->valor_unico) ?>"/>                                            </div>                                        </td>                                        <td <?= $model->valor_unico - (($model->valor_unico * $model->porcentagem_desconto / 100)) < $model->extra()->valor_minimo ? 'style="background: #ff7a7a"' : '' ?>                                                class="valor_unitario_final">                                            R$ <?= Formater::intToCurrency($model->valor_unico - (($model->valor_unico * $model->porcentagem_desconto / 100))) ?></td>                                        <td class="valor_final">                                            R$ <?= Formater::intToCurrency(($model->valor_unico - (($model->valor_unico * $model->porcentagem_desconto / 100))) * $model->quantidade) ?></td>                                        <td style="text-align: center">                                            <button class="remove-unic btn bg-danger-400"><i class="icon-cross2"></i>                                            </button>                                        </td>                                    </tr>                                    <?php                                }                                ?>                                <tr role="row" class="even minus">                                    <td></td>                                    <td colspan="7">                                        <div style="margin: 0" class="form-group">                                            <input id="produtos"                                                   name="produto"                                                   class="form-control" placeholder="Nome do produto"/>                                        </div>                                    </td>                                    <td style="text-align: center">                                        <a href="javascript:;" class="addnew btn bg-blue-400"                                           data-placement="top" data-popup="tooltip"                                           title=""                                           data-original-title="Adicicionar novo produto">                                            <i class="icon-plus2"></i>                                        </a>                                    </td>                                </tr>                                <tr>                                    <td colspan="6"></td>                                    <th>Quantidade total</th>                                    <th>Valor total</th>                                    <th>Remover tudo</th>                                </tr>                                <tr>                                    <td colspan="6"></td>                                    <td class="quantidade_total"><?= $quantidade_total ?></td>                                    <td class="valor_total">                                        R$ <?= Formater::intToCurrency($valor_total + $cart->valor_frete) ?></td>                                    <td style="text-align: center">                                        <button id="remove-all" class="btn bg-danger-400"><i class="icon-cross2"></i>                                        </button>                                    </td>                                </tr>                                </tbody>                            </table>                        </div>                        <div class="datatable-footer">                            <div class="dataTables_info"></div>                            <div class="dataTables_paginate paging_simple_numbers">                                <button class="btn bg-blue-600" id="finalizar-pedido">Finalizar pedido</button>                            </div>                        </div>                    </div>                </div>                <?php            }            ?>            <button id="comfirm-remove-all" style="display: none" type="button" data-toggle="modal"                    data-target="#modal-remove-all"></button>            <div id="modal-remove-all" class="modal fade">                <div class="modal-dialog">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal">×</button>                            <h5 class="modal-title">Esvaziar carrinho</h5>                        </div>                        <div class="modal-body">                            <div class="alert alert-danger alert-styled-left text-slate-800 content-group">                                <span class="text-semibold">Esvaziar carrinho</span> Atenção                                <button type="button" class="close" data-dismiss="alert">Ã—</button>                            </div>                            <p>Essa ação é irreversível. Caso confirme essa ação, todos os itens do carrinho serão                                removidos e então você será direcionado automaticamente para os                                produtos.</p>                            <hr>                        </div>                        <div class="modal-footer">                            <button class="btn bg-blue-400" data-dismiss="modal"><i class="icon-check"></i> Cancelar                            </button>                            <button id="remove-item-all" class="btn bg-danger-400" data-dismiss="modal"><i                                        class="icon-cross2"></i> Remover tudo                            </button>                        </div>                    </div>                </div>            </div>            <button id="comfirm-remove" style="display: none" type="button" data-toggle="modal"                    data-target="#modal-remove"></button>            <div id="modal-remove" class="modal fade">                <div class="modal-dialog">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal">×</button>                            <h5 class="modal-title">Deletar item do carrinho</h5>                        </div>                        <div class="modal-body">                            <div class="alert alert-danger alert-styled-left text-slate-800 content-group">                                <span class="text-semibold">Deletar item</span> Confirmar exclusão do item                                <button type="button" class="close" data-dismiss="alert">Ã—</button>                            </div>                            <p>Essa ação é irreversível. Caso confirme essa ação e deseje voltar atrás, vá até os                                produtos e adicione o item novamente ao carrinho.</p>                            <p>Se seu carrinho ficar vazio após essa ação ser concluída, você será direcionado                                automaticamente para os produtos.</p>                            <hr>                        </div>                        <div class="modal-footer">                            <button class="btn bg-blue-400" data-dismiss="modal"><i class="icon-check"></i> Cancelar                            </button>                            <button id="remove-item" class="btn bg-danger-400" data-dismiss="modal"><i                                        class="icon-cross2"></i> Remover                            </button>                        </div>                    </div>                </div>            </div>            <button id="comfirm-delete" style="display: none" type="button" data-toggle="modal"                    data-target="#modal-delete"></button>            <div id="modal-delete" class="modal fade">                <div class="modal-dialog">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal">×</button>                            <h5 class="modal-title">Impossível finalizar o pedido</h5>                        </div>                        <div class="modal-body">                            <div class="alert alert-danger alert-styled-left text-slate-800 content-group">                                <span class="text-semibold">Finalizando pedido</span> Informe o cliente dono do pedido                                <button type="button" class="close" data-dismiss="alert">Ã—</button>                            </div>                            <p>Não encontramos nenhum cliente designado para o pedido atual. Por favor informe o cliente                                no campo 'Venda será realizada para o seguinte cliente: ' no topo desta página. </p>                            <hr>                        </div>                        <div class="modal-footer">                            <button class="btn bg-danger-400" data-dismiss="modal"><i class="icon-check"></i> OK                            </button>                        </div>                    </div>                </div>            </div>            <button id="comfirm-verify" style="display: none" type="button" data-toggle="modal"                    data-target="#modal-success"></button>            <div id="modal-success" class="modal fade">                <div class="modal-dialog">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal">×</button>                            <h5 class="modal-title">Finalizar o pedido</h5>                        </div>                        <div class="modal-body">                            <div class="alert alert-success alert-styled-left text-slate-800 content-group">                                <span class="text-semibold">Finalizando pedido</span> Está tudo certo com o seu carrinho                                <button type="button" class="close" data-dismiss="alert">Ã—</button>                            </div>                            <p>Verifique mais uma vez os dados do carrinho, uma vez que o pedido for finalizado, não                                será possível alterar o cliente designado do pedido. </p>                            <p><strong>Depois que verificar os dados do carrinho, clique no botão 'Finalizar pedido'                                    novamente.</strong></p>                            <hr>                        </div>                        <div class="modal-footer">                            <button id="add-verify" class="btn bg-success-400" data-dismiss="modal"><i                                        class="icon-check"></i> OK                            </button>                        </div>                    </div>                </div>            </div>        </div>    </div><?php$this->html('_includes/end.content');